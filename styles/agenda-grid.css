/* Base z-index layers */
:root {
  --z-base: 1;
  /* --z-time-indicator-container: 105; /* No lo usamos directamente en el indicador */
  /* --z-time-indicator: 120; /* Vamos a bajarlo */
  /* --z-time-indicator-label: 130; /* Vamos a bajarlo */
  --z-cells: 10;
  --z-events: 20;
  --z-grid-container: 95; /* << NUEVO: Mayor que el indicador (90), menor que hour-column (100) */
  --z-hour-column: 100;
  --z-day-headers: 110; /* Ajustado: > hour-column */
  --z-hour-header: 110; /* Ajustado: > hour-column */
  /* --z-time-indicator-label: 130; /* Superior al indicador pero menor que cabeceras */

  /* Nuevos valores para el indicador */
  --z-time-indicator-new: 90; /* Se mantiene < hour-column y < headers */
  --z-time-indicator-label-new: 95; /* Se mantiene < hour-column y < headers */
  --z-time-indicator-container: 1; /* Restaurado y bajado a 1 */
}

/* Estilos base para la cuadrícula */
.agenda-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  position: relative;
  overflow: hidden;
}

.agenda-body {
  flex: 1;
  overflow: auto;
  position: relative;
  min-height: 0;
  z-index: var(--z-time-indicator-container); /* Restaurado con valor 1 */
}

.agenda-grid {
  position: relative;
  width: 100%;
  border-collapse: collapse;
  z-index: var(--z-base);
}

/* Contenedor real del grid dentro del body */
.agenda-body .grid-container {
  position: relative; /* Necesario para z-index y apilamiento */
  z-index: var(--z-grid-container); /* << RESTAURADO con valor 95 */
  min-width: fit-content;
  isolation: isolate; /* Forzar un nuevo contexto de apilamiento */
}

/* Celdas base donde van las citas */
.grid-cell {
  position: relative;
  border: 1px solid #e5e7eb;
  height: 40px;
  background-color: white;
  z-index: var(--z-cells);
}

/* Elementos superpuestos como citas o bloques */
.agenda-event {
  position: absolute;
  z-index: var(--z-events);
  border-radius: 4px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* Columna de horas - sticky horizontal */
.hour-column,
.agenda-body .grid-container [class*="sticky"][class*="left-0"],
div[class*="sticky"][class*="left-0"] {
  position: sticky !important;
  left: 0;
  z-index: var(--z-hour-column);
  background-color: white;
  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
}

/* Cabeceras de días y cabinas */
.day-header,
.grid-header-cell,
div[class*="sticky"][class*="top-0"]:not([class*="left-0"]) {
  position: sticky !important;
  top: 0 !important;
  /* z-index: 9999 !important; */ /* Usar variable */
  z-index: var(--z-day-headers) !important;
  background-color: white !important;
  border-bottom: 1px solid #e5e7eb !important;
  transform: translateZ(0); /* Mantener por si acaso */
}

/* Cabecera especial "Hora" - esquina superior izquierda */
.hour-header,
div.sticky.left-0.top-0.hour-header,
div[class*="sticky"][class*="left-0"][class*="top-0"][class*="hour-header"],
.agenda-body .grid-container > div:first-child.top-0,
div[class*="sticky"][class*="left-0"][class*="top-0"] {
  position: sticky !important;
  left: 0;
  top: 0;
  z-index: var(--z-hour-header) !important; /* Usar variable y !important */
  background-color: white;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.15);
}

/* Indicador de tiempo actual */
.current-time-indicator {
  position: absolute !important;
  left: 0 !important;
  right: 0 !important;
  width: 100% !important;
  height: 2px !important;
  background-color: #ef4444 !important;
  /* z-index: 120 !important; */ /* Usar nueva variable */
  z-index: var(--z-time-indicator-new) !important;
  pointer-events: none !important;
  min-width: 100% !important;
  box-shadow: 0 0 4px rgba(239, 68, 68, 0.4) !important;
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

/* Garantizar que el pseudoelemento se vea sobre la columna de horas - AJUSTADO */
.current-time-indicator::before {
  content: '' !important;
  position: absolute !important;
  left: 0 !important;
  width: 80px !important; /* Ancho de la columna de hora */
  height: 2px !important;
  background-color: #ef4444 !important;
  /* z-index: 125 !important; */ /* Ajustar relativo a la nueva base */
  z-index: calc(var(--z-time-indicator-new) + 1) !important; /* Un poco por encima del indicador base */
  pointer-events: none !important;
}

/* Etiqueta de hora con posicionamiento absoluto para que se mueva con la columna */
.current-time-indicator span {
  position: absolute !important;
  left: 40px !important; /* Centrado en la columna de hora */
  top: 50% !important;
  transform: translate(-50%, -50%) !important;
  /* z-index: 130 !important; */ /* Usar nueva variable */
  z-index: var(--z-time-indicator-label-new) !important;
  background-color: #ef4444 !important;
  color: white !important;
  padding: 2px 6px !important;
  border-radius: 2px !important;
  font-size: 11px !important;
  white-space: nowrap !important;
  display: inline-block !important;
  font-weight: 500 !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2) !important;
  pointer-events: none !important;
}

/* Eliminar estilos fixed que ya no necesitamos */
body:has(.current-time-indicator) .current-time-indicator span {
  position: absolute !important;
  /* z-index: var(--z-time-indicator-label) !important; */ /* Usar nueva variable */
  z-index: var(--z-time-indicator-label-new) !important;
}

/* Eliminar estilos obsoletos */
.current-time-indicator-portal {
  display: none;
}

/* Asegurar que el indicador tenga menor z-index que todas las cabeceras */
.agenda-body .current-time-indicator {
  /* z-index: var(--z-time-indicator) !important; */
  z-index: var(--z-time-indicator-new) !important;
}

/* Asegurar que la etiqueta no sea ocultada por la columna de horas */
/* Esta regla podría ser problemática si la etiqueta tiene z-index < columna */
/* Vamos a comentarla temporalmente para ver el efecto del z-index */
/*
.hour-column:has(+ .current-time-indicator),
.hour-column:has(~ .current-time-indicator) {
  overflow: visible !important;
}
*/

/* Soporte para WebKit */
@supports (-webkit-touch-callout: none) {
  .hour-header { position: -webkit-sticky; z-index: var(--z-hour-header) !important; }
  .day-header { position: -webkit-sticky; z-index: var(--z-day-headers) !important; }
  .hour-column { position: -webkit-sticky; z-index: var(--z-hour-column); }
} 